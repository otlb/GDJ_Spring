<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
	<!-- namespace는 중복 X -->
	<!-- mapper namespace는 비우면 에러  -->
	<!-- 해당 mapper를 사용할 DAO의 풀패키지명으로 작성 -->
	<mapper namespace="com.winter.app.regions.RegionDAO">
		
		<sql id="search3">
			WHERE 
			<choose>
				<when test="kind=='kind1'">
					TITLE LIKE '%'||#{search}||'%'
				</when>
				<when test="kind=='kind2">
					CONTENTS LIKE '%'||#{search}||'%'
				</when>	
				<otherwise>
					WRITER LIKE '%'||#{search}||'%'
				</otherwise>					
			</choose>			
			
		</sql>
		
		<sql id="search2">
			<!-- 태그 where 1번이 float 2번이 true 일때 앞에 or을 알아서 지워줌  -->
			<where>
			<if test="kind=='kind1' or kind=='kind4'">
			TITLE LIKE '%'||#{search}||'%'			
			</if>
			<if test="kind=='kind2' or kind=='kind4'">
			OR CONTENTS LIKE '%'||#{search}||'%'
			</if>
			<if test="kind=='kind3' or kind=='kind4'">
			OR WRITER LIKE '%'||#{search}||'%'
			</if>
			</where> 
			
			
		</sql>
		
		
		<sql id="search">
			WHERE REGION_NAME LIKE '%'||#{search}||'%'
		</sql>		
	
		<!-- detail  -->
		<!-- id는 DAO의 메서드명 -->
		<select id="getDetail" resultType="RegionDTO" parameterType="RegionDTO">
			SELECT * FROM REGIONS WHERE REGION_ID=#{region_id} 
		</select>
		
		<!-- getTotal -->
		<select id="getTotal" resultType="Long" parameterType="Pager">
			SELECT COUNT(REGION_ID) FROM REGIONS
			<include refid="search"></include>
		</select>
		
		<!-- list -->
		<select id="getList" resultType="RegionDTO" parameterType="Pager">
			SELECT * FROM 
			(
				SELECT ROWNUM R,RG.*FROM 
					( 	
						SELECT * FROM REGIONS
						<include refid="search"></include>						
						ORDER BY REGION_ID DESC
					 )RG
			)
			WHERE R BETWEEN #{startRow} AND #{lastRow}
		</select>
		
		<insert id="addFile" parameterType="RegionFileDTO">
			INSERT INTO REGIONFILES
			VALUES(FILE_SEQ.NEXTVAL,#{region_id},#{fileName},#{oriName})
		</insert>
		
		
		<!-- add -->		
		<insert id="add" parameterType="RegionDTO" >
			INSERT INTO REGIONS VALUES(EMPLOYEES_SEQ.NEXTVAL,#{region_name})		
		</insert>
		
		<!-- update -->
		<update id="update" parameterType="RegionDTO" >
			UPDATE REGIONS SET REGION_NAME=#{region_name} WHERE REGION_ID=#{region_id}
		</update>
		
		<!-- delete -->
		<delete id="delete" parameterType="RegionDTO"> 
			DELETE REGIONS WHERE REGION_ID = #{region_id}
		</delete>
		
		
		
		
		
	</mapper>